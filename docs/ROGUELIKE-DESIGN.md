# 🗡️ Card Wars: 삼국쟁패 — 로그라이크 모드 기획서

> Slay the Spire 스타일 로그라이크 덱빌딩 + 삼국지 세계관
> 
> 작성일: 2026-02-16

---

## 📋 목차

1. [컨셉](#1-컨셉)
2. [게임 흐름](#2-게임-흐름)
3. [맵 구조](#3-맵-구조)
4. [전투 시스템 (기존 활용)](#4-전투-시스템)
5. [보상 & 덱빌딩](#5-보상--덱빌딩)
6. [이벤트 (비전투 노드)](#6-이벤트)
7. [상점](#7-상점)
8. [휴식](#8-휴식)
9. [보물 시스템](#9-보물-시스템)
10. [난이도 & 진행도](#10-난이도--진행도)
11. [기존 시스템 연동](#11-기존-시스템-연동)
12. [데이터 구조](#12-데이터-구조)
13. [UI/UX](#13-uiux)
14. [저장 & 이어하기](#14-저장--이어하기)
15. [PWA](#15-pwa)
16. [구현 우선순위](#16-구현-우선순위)

---

## 1. 컨셉

### 한줄 요약
**"세력을 선택하고, 삼국을 정복하라. 죽으면 처음부터."**

### 핵심 루프
```
세력 선택 → 맵에서 경로 선택 → 전투/이벤트/상점/휴식
    → 카드 보상으로 덱 성장 → 보스 격파 → 다음 장(Act)
    → 최종 보스 클리어 = 삼국통일!
    → 중간에 죽으면? 처음부터! (로그라이크)
```

### Slay the Spire에서 가져올 것
| StS 요소 | Card Wars 적용 |
|---------|---------------|
| 캐릭터 4종 | 부스터팩 운으로 시작 덱 결정 (매번 다름!) |
| 카드 드래프트 | 전투 보상으로 무장/전법 카드 선택 |
| 보물 | 보물 (패시브 버프) |
| 맵 분기 | 진군 경로 (전투/이벤트/상점/휴식) |
| 3 Act + 보스 | 3장 (황건토벌/군웅할거/삼국대전) + 최종보스 |
| 엘리트 | 네임드 무장 (여포, 관우 등) |
| ? 이벤트 | 삼국지 고사 이벤트 |

### StS와 다른 점
- **시작부터 랜덤** — 부스터팩 가챠로 시작 덱 결정 (세력 선택 없음!)
- **덱 = 무장 3명 + 전법 2장** (StS처럼 수십장이 아님)
- 전투마다 덱을 **교체/강화** — 카드를 추가하는 게 아니라 **더 강한 무장으로 교체**
- **레인 배치** (전위/중위/후위) 전략 유지
- **세력 시너지** 활용 or 혼합 덱 전략 — 부스터 운에 따라 자연스럽게 결정

---

## 2. 게임 흐름

### 런(Run) 시작
1. **부스터팩 개봉** — 일반팩 3개 지급 → 찢어서 카드 획득!
2. **덱 편성** — 나온 카드로 무장 3명 + 전법 2장 편성
3. **맵 공개** — Act 1 진군 경로 표시

### 시작 부스터 (일반팩 × 3)

기존 가챠 시스템 그대로 활용! 일반팩 = 카드 3장 (⭐ 1장 보장)

```
팩 1: 🃏🃏🃏  →  장합(⭐), 매복(⭐), 감녕(⭐⭐)
팩 2: 🃏🃏🃏  →  기령(⭐), 회복(⭐), 황충(⭐⭐)
팩 3: 🃏🃏🃏  →  반장(⭐), 도발(⭐), 서황(⭐⭐)
                  (예시 — 실제로는 랜덤)
```

**총 9장** 중에서 덱 편성 (무장 3 + 전법 2)

#### 무장 부족 방지 (Safety Net)
- 9장 중 **무장이 3장 미만**일 경우 → 부족한 만큼 무장 확정 재추첨
- 9장 중 **전법이 2장 미만**일 경우 → 부족한 만큼 전법 확정 재추첨
- 이래도 런마다 시작 덱이 완전히 다름 → **로그라이크 리플레이 가치!**

#### 왜 세력 선택이 아닌가?
- 부스터에서 **어떤 세력이 나올지 모름** → 매번 다른 전략 강제
- "위 올인 시너지" vs "혼합 강캐 조합" 선택이 자연스럽게 발생
- 기존 부스터팩 찢기 연출 그대로 활용 (이미 구현됨! ✅)
- **가챠의 재미** + **로그라이크의 랜덤성** 시너지

#### 메타 진행도로 시작팩 업그레이드
| 해금 조건 | 보상 |
|----------|------|
| 첫 클리어 | 시작 팩 → 일반팩 2 + **희귀팩 1** |
| 난이도 1 클리어 | 시작 팩 → 일반팩 1 + 희귀팩 2 |
| 난이도 2 클리어 | 시작 팩 → 희귀팩 2 + **영웅팩 1** |
| 난이도 3 클리어 | 시작 팩 → 희귀팩 1 + 영웅팩 2 |

→ 반복 플레이할수록 시작이 살짝 유리해짐 (하지만 난이도도 올라감!)

### 런 진행
```
Act 1: 황건토벌 (노드 8개) → 보스: 장각
Act 2: 군웅할거 (노드 9개) → 보스: 동탁 + 여포
Act 3: 삼국대전 (노드 10개) → 최종보스: 가장 많이 모은 세력의 라이벌 연합
```

### 런 종료 조건
- **승리:** Act 3 최종 보스 격파 → 삼국통일! 🏆
- **패배:** 전투에서 무장 3명 전멸 → 런 종료, 처음부터

---

## 3. 맵 구조

### 노드 타입
| 아이콘 | 타입 | 설명 |
|--------|------|------|
| ⚔️ | 일반 전투 | 약한 적과 전투, 카드 보상 |
| 💀 | 엘리트 전투 | 강력한 네임드 무장, 보물 보상 |
| ❓ | 이벤트 | 삼국지 고사 기반 선택지 |
| 🏪 | 상점 | 금 사용해서 카드 구매/제거 |
| 🏕️ | 휴식 | HP 회복 or 카드 강화 |
| 👑 | 보스 | Act의 마지막, 보스전 |

### 맵 생성 규칙
```
시작 ─┬─ ⚔️ ─┬─ ⚔️ ─── ❓ ─┬─ 💀 ─── 🏕️ ─┬─ ⚔️ ─── 👑
      │       │              │              │
      └─ ❓ ─┴─ 💀 ─── 🏪 ─┴─ ⚔️ ─── ⚔️ ─┘
```

- **가로 7~10열**, 세로 2~3행 (분기)
- 플레이어가 **경로 선택** (위/아래 갈림길)
- Act 1: 엘리트 1~2개, Act 3: 엘리트 3~4개
- 상점은 Act당 1~2개 보장
- 휴식은 보스 직전에 1개 보장
- 첫 노드는 항상 일반 전투 (워밍업)

### 맵 생성 알고리즘
1. 열(column) 수 결정 (Act에 따라)
2. 각 열에 2~3개 노드 배치
3. 노드 타입 랜덤 배정 (규칙 내에서)
4. 인접 열끼리 간선(edge) 연결 (최소 1개, 최대 2개)
5. 시작→끝 모든 경로가 연결되는지 검증

---

## 4. 전투 시스템

### 기존 시스템 최대 활용! ✅

현재 Card Wars의 전투 시스템을 **그대로 사용**:
- 3x1 레인 (전위/중위/후위) 배치
- 전법 카드 2장 (턴 시작 시 사용)
- 무장 스킬 (active/passive/ultimate)
- 전장 이벤트 (날씨/지형)
- 세력 시너지

### 로그라이크에서 달라지는 점

| 항목 | 기존 | 로그라이크 |
|------|------|-----------|
| HP | 매 전투 풀 회복 | **런 전체에서 HP 유지** (핵심!) |
| 덱 교체 | 자유 | 보상으로 획득한 카드로만 |
| 전법 선택 | 인벤토리에서 | 보유 전법 중 2장 선택 |
| 난이도 | 고정 | Act 진행에 따라 상승 |
| 전장 이벤트 | 랜덤 | 노드별 고정 (맵에서 미리 표시) |

### HP 시스템 (새로 추가)
```
런 시작 시 → 팀 HP: 100
전투 중 무장 데미지 → 팀 HP 감소
전투 승리해도 HP 자동 회복 없음!
HP 0 = 런 종료 (Game Over)
```

- **팀 HP** 방식 (개별 무장 HP가 아닌 공유 HP)
- 전투에서 받은 피해가 **누적**됨 → 휴식/이벤트에서만 회복
- 전투 승리 시 소량 회복 (5~10%) 가능 (밸런스 조절)

### 적 구성 (Act별)

#### Act 1: 황건토벌
| 노드 | 적 구성 | 특징 |
|------|---------|------|
| 일반 | 1성 무장 3명 | 스킬 없음~1개 |
| 엘리트 | 장보 (2성) + 잡병 2명 | 독 스킬 |
| 보스 | 장각 (3성) + 장량·장보 (2성) | 힐 + 광역기 |

#### Act 2: 군웅할거
| 노드 | 적 구성 | 특징 |
|------|---------|------|
| 일반 | 2성 무장 2명 + 1성 1명 | 스킬 1~2개 |
| 엘리트 | 여포 (4성) 단독 | 일기당천 주의! |
| 보스 | 동탁 (3성) + 여포 (4성) + 화웅 (2성) | 조합 시너지 |

#### Act 3: 삼국대전
| 노드 | 적 구성 | 특징 |
|------|---------|------|
| 일반 | 2~3성 무장 3명 | 세력 시너지 활성 |
| 엘리트 | 사마의/주유/제갈량 (4성) + 2성 2명 | 궁극기 보유 |
| 보스 | 적 세력 탑 3 무장 | 풀 시너지 + 보물 |

---

## 5. 보상 & 덱빌딩

### 전투 승리 보상 — 부스터팩!

**모든 보상은 부스터팩으로 통일.** 찢는 맛이 이 게임의 핵심!

```
일반 전투:
  - 💰 금 15~25
  - 📦 일반팩 1개

엘리트 전투:
  - 💰 금 30~50
  - 📦 희귀팩 1개
  - 🏺 보물 1개 (2~3개 중 택 1)

보스 전투:
  - 💰 금 50~100
  - 📦 영웅팩 1개
  - 🏺 보스 전용 보물 확정 1개
  - 다음 Act 해금
```

### 부스터 개봉 후 덱 편성
부스터에서 나온 카드는 **인벤토리**에 추가됨.
인벤토리에서 자유롭게 **덱 편성** (무장 3 + 전법 2):

```
📦 희귀팩 개봉!

🃏 장료 (⭐⭐)  🃏 화공 (⭐)  🃏 주유 (⭐⭐⭐)  🃏 도발 (⭐)

→ 인벤토리에 추가됨

[덱 편성하기]  [나중에]
```

- **중복 카드** → 기존 카드 레벨업 (+1) 자동 적용
- 전투 사이 맵에서 언제든 **덱 편성 변경** 가능
- 인벤토리가 넉넉해야 교체 전략이 재밌음

### 덱빌딩 전략
- **무장 교체:** 더 강한 무장이 나오면 덱에서 스왑
- **무장 강화:** 같은 무장 중복 → 자동 레벨업 (가챠 시스템 그대로!)
- **전법 교체:** 상황에 맞는 전법으로 교체
- **세력 전략:** 같은 세력으로 통일 (시너지) vs 혼합 (개별 강캐 조합)
- **인벤토리 관리:** 상점에서 불필요한 카드 판매 가능

### Act별 부스터 등급 변화
| 전투 타입 | Act 1 | Act 2 | Act 3 |
|----------|-------|-------|-------|
| 일반 전투 | 일반팩 | 일반팩 | 희귀팩 |
| 엘리트 | 희귀팩 | 영웅팩 | 영웅팩 |
| 보스 | 영웅팩 | 영웅팩 | **전설팩** |

---

## 6. 이벤트

삼국지 고사를 모티브로 한 **선택지 이벤트**:

### 이벤트 목록

#### 🍑 도원결의
> *"세 사람이 의형제를 맺겠다 합니다."*
- **선택 A:** 함께한다 → 촉 무장 1명 획득 (랜덤)
- **선택 B:** 거절한다 → 💰 금 30

#### 🔥 적벽의 불길
> *"강 위에 불길이 번지고 있습니다."*
- **선택 A:** 불 속으로! → HP -15, 전법 '화공' 강화 (+1레벨)
- **선택 B:** 우회한다 → 아무 일 없음

#### 🏯 삼고초려
> *"초당에 현자가 있다는 소문을 들었습니다."*
- **선택 A:** 세 번 방문한다 → HP -10, ⭐⭐⭐ 카드 1장 획득
- **선택 B:** 포기한다 → HP +10

#### ⚔️ 단기필마
> *"적장이 일기토를 청합니다."*
- **선택 A:** 받아들인다 → 미니 배틀 (1vs1) → 승리 시 적 무장 카드 획득
- **선택 B:** 거절한다 → 💰 금 20

#### 🐴 적토마
> *"명마를 발견했습니다!"*
- **선택 A:** 길들인다 (50% 성공) → 성공: 보물 '적토마' / 실패: HP -20
- **선택 B:** 놓아준다 → HP +10

#### 📜 밀서
> *"적의 밀서를 입수했습니다."*
- **선택 A:** 읽는다 → 다음 전투 적 전법 카드 공개
- **선택 B:** 팔아넘긴다 → 💰 금 40

#### 🍺 주연
> *"마을에서 주연을 베풀어 주었습니다."*
- **선택 A:** 마음껏 먹는다 → HP +25, 다음 전투 전위 행동불가
- **선택 B:** 절제한다 → HP +10

#### 🎭 미인계
> *"미인을 보내 적장을 유혹합니다."*
- **선택 A:** 실행한다 → 현재 덱에서 카드 1장 제거 (선택)
- **선택 B:** 거절한다 → 아무 일 없음

#### 🏔️ 산적 소굴
> *"산적들이 통행료를 요구합니다."*
- **선택 A:** 싸운다 → 일반 전투 (승리 시 💰 금 50)
- **선택 B:** 지불한다 → 💰 금 -25
- **선택 C:** 설득한다 (지력 의존) → 성공 시 산적 무장 합류

---

## 7. 상점

### 상점 구성
```
┌──────────────────────────────────────┐
│  🏪 상점                              │
├──────────────────────────────────────┤
│                                      │
│  📦 무장 카드 (3장)                    │
│  ⭐⭐ 장료 ............... 💰 50      │
│  ⭐⭐⭐ 주유 ............. 💰 120     │
│  ⭐⭐ 감녕 ............... 💰 60      │
│                                      │
│  📜 전법 카드 (2장)                    │
│  ⭐⭐ 낙석 ............... 💰 40      │
│  ⭐ 도발 ................. 💰 20      │
│                                      │
│  🏺 보물 (1개)                        │
│  옥새 .................... 💰 150     │
│                                      │
│  ──────────────────────              │
│  🗑️ 카드 제거 ............ 💰 75      │
│  ❤️ HP 회복 (+30) ........ 💰 60      │
│                                      │
└──────────────────────────────────────┘
```

### 가격표
| 항목 | 가격 범위 | 비고 |
|------|----------|------|
| ⭐ 카드 | 20~30 | |
| ⭐⭐ 카드 | 50~70 | |
| ⭐⭐⭐ 카드 | 100~140 | |
| 🌟 카드 | 180~250 | 희귀 출현 |
| 보물 | 100~200 | 1개만 |
| 카드 제거 | 75 (사용할수록 +25) | 덱 다이어트 |
| HP 회복 | 60 | +30 HP |

---

## 8. 휴식

보스 전 마지막 준비! 2가지 중 택 1:

### 🔥 모닥불
- **휴식:** HP 30% 회복
- **강화:** 무장 카드 1장 레벨업 (+1)

강화 시 무장 선택 화면:
```
강화할 무장을 선택하세요:

[장료 Lv.2 → Lv.3]  [서황 Lv.1 → Lv.2]  [조조 Lv.3 → Lv.4]
  무력 8→9              방어 4→5             통솔 9→10
```

---

## 9. 보물 시스템

### 보물 (寶物)

런 동안 지속되는 **패시브 효과**. 최대 3개 보유 (MVP).
삼국지에 실제로 등장하는 무기, 서적, 명마, 보옥 등.

### 보물 슬롯
```
┌─────────────────────────────────┐
│  🏺 보물함        [1/3]          │
│                                 │
│  🐴 적토마   ⚔️ 청룡언월도       │
│  항상 선공    무력+3             │
│                                 │
│  [ 빈 슬롯 ]                    │
└─────────────────────────────────┘
```
- 보물이 꽉 찬 상태에서 새 보물 획득 → **하나 버리고 교체**
- 버린 보물은 사라짐 (신중한 선택!)

### 보물 목록 (MVP: 10개)

#### ⚔️ 무기 (공격 계열)

| 이름 | 효과 | 유래 |
|------|------|------|
| ⚔️ **청룡언월도** | 전위 무장 무력 +3 | 관우의 언월도. 82근의 명도 |
| 🗡️ **의천검** | 전투 시작 시 적 전위 방어 -2 | 조조의 보검. 천자를 호위하는 칼 |
| 🔱 **방천화극** | 공격 시 20% 확률로 2회 타격 | 여포의 방천화극. 천하무쌍의 극 |

#### 🛡️ 방어구 (방어 계열)

| 이름 | 효과 | 유래 |
|------|------|------|
| 🛡️ **등갑** | 화공 데미지 무효 | 남만 등나무 갑옷. 물에 뜨고 칼을 막음 |
| 👑 **면류관** | 턴 시작 시 아군 전체 방어 +1 | 황제의 관. 위엄이 아군을 지킴 |

#### 📖 서적 (지력/전법 계열)

| 이름 | 효과 | 유래 |
|------|------|------|
| 📖 **손자병법** | 전법 데미지 +30% | 손무의 병법서. 전술의 근본 |
| 📜 **태평요술서** | 전투 승리 시 HP +8 회복 | 장각의 도술서. 치유의 술법 |

#### 🐴 명마 (유틸리티)

| 이름 | 효과 | 유래 |
|------|------|------|
| 🐴 **적토마** | 항상 선공 (선제 행동) | 하루에 천리를 달리는 명마. 여포→관우 |
| 🦌 **적로마** | 피격 시 15% 확률로 회피 | 유비의 명마. 단계를 뛰어넘어 주인을 구함 |

#### 💎 보옥

| 이름 | 효과 | 유래 |
|------|------|------|
| 👑 **전국옥새** | 금 획득량 +50% | 천자의 인장. 이것을 가진 자가 천하의 주인 |

### 보물 획득 경로
| 경로 | 보물 종류 |
|------|----------|
| 엘리트 전투 승리 | 랜덤 보물 1개 (2~3개 중 택 1) |
| 보스 전투 승리 | 해당 보스 테마 보물 확정 1개 |
| ❓ 이벤트 | 특정 선택지에서 획득 가능 |
| 🏪 상점 | 고가에 구매 가능 (💰 100~200) |

### 보물 데이터 구조
```typescript
interface Relic {
  id: string;
  name: string;
  description: string;      // 효과 설명
  lore: string;             // 삼국지 유래 (툴팁)
  icon: string;             // 이모지
  category: 'weapon' | 'armor' | 'book' | 'horse' | 'jewel';
  effect: RelicEffect;
}

type RelicEffect =
  | { type: 'stat_boost'; target: 'front' | 'all'; stat: keyof WarriorStats; value: number }
  | { type: 'first_strike' }
  | { type: 'heal_on_win'; value: number }
  | { type: 'gold_boost'; percent: number }
  | { type: 'tactic_boost'; percent: number }
  | { type: 'debuff_enemy'; stat: keyof WarriorStats; value: number; target: 'front' }
  | { type: 'double_strike'; chance: number }
  | { type: 'dodge'; chance: number }
  | { type: 'immune_fire' }
  | { type: 'defense_per_turn'; value: number };
```

---

## 10. 난이도 & 진행도

### 난이도 단계
| 단계 | 이름 | 해금 조건 | 변경 사항 |
|------|------|----------|----------|
| 0 | 평정 | 기본 | 기본 밸런스 |
| 1 | 난세 | 1회 클리어 | 적 HP +20%, 금 -10% |
| 2 | 혼돈 | 난세 클리어 | 적 HP +40%, 엘리트 추가, 상점 비쌈 |
| 3 | 지옥 | 혼돈 클리어 | 적 HP +60%, HP 회복 50% 감소 |

### 메타 진행도 (런 간 영속)
런을 반복하면서 **영구 해금**되는 요소:

| 해금 조건 | 보상 |
|----------|------|
| 첫 클리어 | 시작 팩 업그레이드 (일반2 + 희귀1) |
| 난이도 1 클리어 | 시작 팩 업그레이드 (일반1 + 희귀2) |
| 난이도 2 클리어 | 시작 팩 업그레이드 (희귀2 + 영웅1) |
| 난이도 3 클리어 | 시작 팩 업그레이드 (희귀1 + 영웅2) |
| 엘리트 20회 처치 | 보물 슬롯 +1 (최대 6개) |
| 50회 런 | 모든 이벤트 해금 |
| 난이도 3 클리어 | 특수 칭호 "천하통일" |
| 전 세력 시너지로 클리어 (각 1회) | 🌟 전설팩 시작 보너스 해금 |

---

## 11. 기존 시스템 연동

### 재사용 (그대로)
- ✅ `src/lib/battle/` — 전투 엔진 전체
- ✅ `src/components/battle/` — 배틀 UI 전체
- ✅ `src/data/cards.ts` — 무장/전법 카드 데이터
- ✅ `src/data/battlefield-events.ts` — 전장 이벤트
- ✅ `src/types/game.ts` — 타입 정의
- ✅ `src/lib/gacha.ts` — 등급별 가중치 로직 활용

### 수정 필요
- 🔧 `BattleArena` — HP 누적 시스템 연동
- 🔧 `GameState` — 로그라이크 런 상태 추가
- 🔧 `src/lib/battle/ai.ts` — Act별 난이도 조절

### 새로 만들 것
- 🆕 맵 생성기 (`src/lib/roguelike/map-generator.ts`)
- 🆕 이벤트 엔진 (`src/lib/roguelike/events.ts`)
- 🆕 보물 시스템 (`src/lib/roguelike/relics.ts`)
- 🆕 상점 로직 (`src/lib/roguelike/shop.ts`)
- 🆕 런 상태 관리 (`src/context/run-context.tsx`)
- 🆕 맵 UI (`src/components/roguelike/RunMap.tsx`)
- 🆕 이벤트 UI (`src/components/roguelike/EventScreen.tsx`)
- 🆕 상점 UI (`src/components/roguelike/ShopScreen.tsx`)
- 🆕 카드 선택 UI (`src/components/roguelike/CardReward.tsx`)
- 🆕 휴식 UI (`src/components/roguelike/RestSite.tsx`)
- 🆕 런 요약 화면 (`src/components/roguelike/RunSummary.tsx`)

---

## 12. 데이터 구조

### RunState (런 진행 상태)
```typescript
interface RunState {
  id: string;
  faction: Faction;                // 선택 세력
  currentAct: 1 | 2 | 3;
  currentNodeId: string;           // 현재 위치
  teamHp: number;                  // 팀 HP (공유)
  maxTeamHp: number;               // 최대 HP
  gold: number;                    // 소지금
  deck: RunDeck;                   // 현재 덱
  relics: Relic[];                 // 보유 보물
  map: ActMap;                     // 현재 Act 맵
  visitedNodes: string[];          // 방문한 노드
  difficulty: 0 | 1 | 2 | 3;      // 난이도
  stats: RunStats;                 // 런 통계
}

interface RunDeck {
  warriors: RunWarrior[];          // 무장 3명
  tactics: RunTactic[];            // 전법 카드 (보유 전체, 전투 시 2장 선택)
}

interface RunWarrior {
  cardId: string;
  level: number;
  lane: Lane;
}

interface RunTactic {
  cardId: string;
  level: number;
}

interface RunStats {
  battlesWon: number;
  elitesKilled: number;
  goldEarned: number;
  cardsObtained: number;
  damageDealt: number;
  damageTaken: number;
  turnsPlayed: number;
}
```

### ActMap (맵 데이터)
```typescript
interface ActMap {
  act: 1 | 2 | 3;
  nodes: MapNode[];
  edges: MapEdge[];                // 노드 간 연결
}

interface MapNode {
  id: string;
  type: 'battle' | 'elite' | 'event' | 'shop' | 'rest' | 'boss';
  column: number;                  // x 위치 (0 = 시작)
  row: number;                     // y 위치 (분기)
  enemyConfig?: EnemyConfig;       // 전투 노드용
  eventId?: string;                // 이벤트 노드용
  fieldEvent?: BattleFieldEvent;   // 전장 이벤트 (미리 표시)
}

interface MapEdge {
  from: string;                    // 노드 id
  to: string;
}

interface EnemyConfig {
  warriors: { cardId: string; level: number; lane: Lane }[];
  tactics: { cardId: string; level: number }[];
  bonusHp?: number;                // 난이도 보정
}
```

### MetaProgress (영구 진행도)
```typescript
interface MetaProgress {
  totalRuns: number;
  totalWins: number;
  highestDifficulty: number;
  unlockedFactions: Faction[];     // 기본 3 + 군벌
  unlockedStarterDecks: string[];  // 대체 시작 덱
  eliteKills: number;
  achievements: string[];
}
```

---

## 13. UI/UX

### 라우팅
```
/roguelike              → 세력 선택 & 런 시작
/roguelike/map          → 맵 화면 (경로 선택)
/roguelike/battle       → 전투 (기존 BattleArena 재사용)
/roguelike/event        → 이벤트 선택지
/roguelike/shop         → 상점
/roguelike/rest         → 휴식/강화
/roguelike/reward       → 전투 보상 (카드 선택)
/roguelike/summary      → 런 종료 요약
```

### 맵 화면 (핵심 UI)
```
Act 1: 황건토벌                    HP: ❤️ 85/100   💰 45

         ⚔️ ─── ❓ ──┐
        /              \
시작 ─ ⚔️      💀 ─── 🏪 ─── 🏕️ ─── 👑
        \              /              장각
         ❓ ─── ⚔️ ──┘

[현재 덱]  장합 Lv.2 | 서황 Lv.3 | 장료 Lv.2
           매복 Lv.1 | 회복 Lv.2
[보물]     🐴 적토마 | 📖 손자병법
```

- 방문한 노드는 흐리게
- 현재 선택 가능한 노드 강조 (글로우)
- 터치로 경로 선택 (모바일 최적화)

### 전투 후 보상 화면
```
⚔️ 전투 승리!

💰 +22 금

📦 희귀팩 획득!

    ┌─────────────┐
    │  ✨ 희귀팩  │
    │             │
    │   [찢기!]   │
    └─────────────┘

→ 기존 부스터 찢기 연출 그대로!
→ 나온 카드는 인벤토리에 추가
→ [덱 편성] 또는 [계속 진군]
```

### 런 종료 요약
```
🏆 삼국통일! (or 💀 패배...)

═══════════════════════════
  Act 3 · 노드 24/26 방문
  세력: 위
  난이도: 평정
═══════════════════════════

  ⚔️ 전투 승리: 18
  💀 엘리트 처치: 4
  💰 획득 금: 842
  ❤️ 최종 HP: 35/100
  🃏 획득 카드: 12
  ⏱️ 플레이 시간: 25분

  최종 덱:
  조조 Lv.5 | 사마의 Lv.3 | 장료 Lv.4
  화공 Lv.3 | 매복 Lv.2

  보물: 🐴🛡️📖🔮👑

  [ 다시 도전 ]  [ 메인으로 ]
```

---

## 14. 저장 & 이어하기

### 핵심 원칙
> **언제든 끄고, 언제든 이어할 수 있다.**
> 출퇴근 지하철에서 시작 → 점심에 이어하기 → 밤에 마무리

### 자동 저장 (Auto-Save)
모든 상태 변경 시점에 **즉시** localStorage에 저장:

| 저장 시점 | 저장 내용 |
|----------|----------|
| 맵 노드 선택 | 현재 위치, 방문 기록 |
| 전투 시작 | 적 구성, 현재 덱 상태 |
| 전투 중 매 턴 | 전투 전체 상태 (BattleState) |
| 전투 종료 | 결과, HP 변화 |
| 카드 보상 선택 | 덱 변경 사항 |
| 이벤트 선택 | 선택 결과 반영 |
| 상점 거래 | 금/카드 변경 |
| 휴식 선택 | HP/강화 결과 |

### 저장 데이터 구조
```typescript
interface SaveData {
  version: number;            // 마이그레이션용
  runState: RunState;         // 런 전체 상태
  battleSnapshot?: BattleState; // 전투 중이었으면 전투 상태도
  timestamp: number;          // 마지막 저장 시간
  playTimeMs: number;         // 누적 플레이 시간
}

// localStorage 키
const SAVE_KEY = 'card-wars-run-save';
const META_KEY = 'card-wars-meta';    // 메타 진행도 (영구)
```

### 이어하기 플로우
```
앱 실행
  ├─ 저장 데이터 있음?
  │   ├─ YES → "이어하기" 버튼 표시
  │   │        (저장 시점 정보: "Act 2 · 노드 8/14 · HP 67/100 · 3시간 전")
  │   │        ├─ 전투 중 저장 → 해당 턴부터 재개
  │   │        ├─ 맵 화면 저장 → 맵으로 복귀
  │   │        └─ 이벤트/상점 저장 → 해당 화면 복귀
  │   └─ NO → "새 원정" 버튼만
  └─ "새 원정" 선택 시 기존 저장 경고
      → "진행 중인 원정을 포기하시겠습니까?"
```

### 전투 중 이탈 처리
- 전투 중 앱을 닫아도 **매 턴 자동 저장**
- 돌아오면 해당 턴의 시작부터 재개
- 애니메이션은 스킵하고 상태만 복원

### 다중 저장 슬롯 (Phase 2)
- MVP: 저장 슬롯 1개 (진행 중인 런 1개만)
- 향후: 슬롯 3개 → 다른 전략으로 동시 진행 가능

---

## 15. PWA

### 설정

#### manifest.json
```json
{
  "name": "삼국쟁패: Card Wars",
  "short_name": "Card Wars",
  "description": "삼국지 로그라이크 카드 배틀",
  "start_url": "/",
  "display": "standalone",
  "orientation": "portrait",
  "background_color": "#0a0a0a",
  "theme_color": "#b91c1c",
  "icons": [
    { "src": "/icons/icon-192.png", "sizes": "192x192", "type": "image/png" },
    { "src": "/icons/icon-512.png", "sizes": "512x512", "type": "image/png" },
    { "src": "/icons/icon-maskable-512.png", "sizes": "512x512", "type": "image/png", "purpose": "maskable" }
  ]
}
```

#### Service Worker 전략
```
캐시 우선 (Cache First):
  - 정적 에셋 (이미지, 폰트, CSS, JS)
  - 카드 일러스트
  - 사운드 파일

네트워크 우선 (Network First):
  - HTML 페이지 (업데이트 반영)

오프라인 지원:
  - 게임 전체가 클라이언트 사이드 → 완전 오프라인 플레이 가능!
  - localStorage 기반 저장 → 네트워크 불필요
```

#### Next.js PWA 설정
```bash
# next-pwa 또는 @serwist/next 사용
npm install @serwist/next
```

### PWA 기능 체크리스트
| 기능 | 설명 | 우선순위 |
|------|------|---------|
| 홈 화면 추가 | "앱 설치" 배너 표시 | 🔴 필수 |
| 오프라인 플레이 | SW 캐싱으로 완전 오프라인 | 🔴 필수 |
| 풀스크린 | `display: standalone` → 브라우저 UI 없음 | 🔴 필수 |
| 세로 고정 | `orientation: portrait` | 🟡 권장 |
| 스플래시 스크린 | 앱 아이콘 + 배경색 | 🟡 권장 |
| 앱 아이콘 | 192px + 512px + maskable | 🔴 필수 |
| 상태바 테마 | `theme_color` 빨간색 (삼국지 느낌) | 🟢 선택 |

### iOS 추가 메타태그
```html
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<link rel="apple-touch-icon" href="/icons/icon-192.png" />
```

### 앱 설치 유도
```
첫 방문 시 (iOS Safari):
  → 하단 배너: "홈 화면에 추가하면 앱처럼 플레이!"
  → 📲 아이콘 + 간단 안내

Android Chrome:
  → 자동 "앱 설치" 프롬프트 (beforeinstallprompt)
```

---

## 16. 구현 우선순위

### Phase 1: 코어 루프 (MVP) 🎯
> 목표: 부스터 개봉 → 맵 → 전투 → 보상 → 저장/이어하기

1. **PWA 설정** — manifest, SW, 오프라인 캐싱, 앱 아이콘
2. **RunState & RunContext** — 런 상태 관리
3. **자동 저장 & 이어하기** — 모든 시점 저장, 복원 플로우
4. **시작 부스터 개봉** — 일반팩 3개 → 덱 편성
5. **맵 생성기** — Act 1 맵 (8 노드)
6. **맵 UI** — 경로 선택 & 이동
7. **HP 누적 시스템** — BattleArena 연동
8. **부스터 보상** — 전투 승리 → 팩 획득 → 찢기 → 인벤토리 → 덱 편성
9. **Act 1 보스** — 장각전
10. **런 종료** — 승리/패배 판정 & 요약

### Phase 2: 깊이 추가
11. **이벤트 시스템** — 5개 이벤트부터
12. **상점** — 카드 구매/제거
13. **휴식** — HP 회복/강화 선택
14. **보물 시스템** — 3~5개 보물부터
15. **Act 2, 3** — 스토리 연결, 보스 추가

### Phase 3: 리플레이 가치
16. **난이도 시스템** — 4단계
17. **메타 진행도** — 영구 해금 (시작팩 업그레이드 등)
18. **다중 저장 슬롯** — 동시 3개 런 관리

### Phase 4: 폴리시
19. **사운드** — BGM & 효과음
20. **연출** — 보스 등장 컷씬, 이벤트 일러스트
21. **밸런스 조정** — 플레이테스트 기반
22. **iOS/Android 설치 유도** — 배너, 온보딩

---

## 📝 참고

### Slay the Spire 밸런스 포인트
- 평균 런 시간: 30~45분 → Card Wars **20~30분** 목표
- Act당 노드: **8~10개** (집중력 유지)
- 엘리트 보상이 강력해야 리스크-리워드 성립
- 카드 제거가 카드 추가만큼 중요 (덱 다이어트)
- 이벤트는 **의미 있는 선택**이어야 함 (정답이 없는 트레이드오프)

### 모바일 UX
- 맵은 **세로 스크롤** (폰 화면에 맞게)
- 카드 선택은 **스와이프** 가능
- 한 손 조작 가능한 UI
- 전투 속도 조절 (1x / 2x / 스킵)
